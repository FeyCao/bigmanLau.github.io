window.__require=function t(e,i,o){function r(n,a){if(!i[n]){if(!e[n]){var h=n.split("/");if(h=h[h.length-1],!e[h]){var c="function"==typeof __require&&__require;if(!a&&c)return c(h,!0);if(s)return s(h,!0);throw new Error("Cannot find module '"+n+"'")}}var l=i[n]={exports:{}};e[n][0].call(l.exports,function(t){return r(e[n][1][t]||t)},l,l.exports,t,e,i,o)}return i[n].exports}for(var s="function"==typeof __require&&__require,n=0;n<o.length;n++)r(o[n]);return r}({BombEffect:[function(t,e,i){"use strict";cc._RF.push(e,"faddfBM/KlH4aQhvZL2kCJr","BombEffect"),Object.defineProperty(i,"__esModule",{value:!0});var o=cc._decorator,r=o.ccclass,s=(o.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.tileH=44,e.tileW=40,e.isStartAnim=!1,e.speed=12,e.upAnimed=!1,e.downAnimed=!1,e.leftAnimed=!1,e.rightAnimed=!1,e}return __extends(e,t),e.prototype.onLoad=function(){this.upNode=this.node.getChildByName("up"),this.upScaleNode=this.node.getChildByName("upScale"),this.downNode=this.node.getChildByName("down"),this.downScaleNode=this.node.getChildByName("downScale"),this.leftNode=this.node.getChildByName("left"),this.leftScaleNode=this.node.getChildByName("leftScale"),this.rightNode=this.node.getChildByName("right"),this.rightScaleNode=this.node.getChildByName("rightScale")},e.prototype.start=function(){},e.prototype.show=function(t,e,i,o){this.up=t,this.down=e,this.left=i,this.right=o,this.up>0&&(this.upNode.active=!0),this.down>0&&(this.downNode.active=!0),this.left>0&&(this.leftNode.active=!0),this.right>0&&(this.rightNode.active=!0),this.isStartAnim=!0},e.prototype.update=function(){this.isStartAnim&&(this.upAnimed||(this.upScaleNode.height<(this.up-1)*this.tileH&&(this.upScaleNode.height+=this.speed),this.upNode.y<this.up*this.tileH?this.upNode.y+=this.speed:(this.upNode.y=this.up*this.tileH,this.upAnimed=!0)),this.downAnimed||(this.downScaleNode.height<(this.down-1)*this.tileH&&(this.downScaleNode.height+=this.speed),this.downNode.y>-this.down*this.tileH?this.downNode.y-=this.speed:(this.downNode.y=-this.down*this.tileH,this.downAnimed=!0)),this.leftAnimed||(this.leftScaleNode.width<(this.left-1)*this.tileW&&(this.leftScaleNode.width+=this.speed),this.leftNode.x>-this.left*this.tileW?this.leftNode.x-=this.speed:(this.leftNode.x=-this.left*this.tileW,this.leftAnimed=!0)),this.rightAnimed||(this.right>0&&this.rightScaleNode.width<(this.right-1)*this.tileW&&(this.rightScaleNode.width+=this.speed),this.rightNode.x<this.right*this.tileW?this.rightNode.x+=this.speed:(this.rightNode.x=this.right*this.tileW,this.rightAnimed=!0)),this.upAnimed&&this.downAnimed&&this.leftAnimed&&this.rightAnimed&&(this.isStartAnim=!0,this.node.parent=null))},e=__decorate([r],e)}(cc.Component));i.default=s,cc._RF.pop()},{}],Bomb:[function(t,e,i){"use strict";cc._RF.push(e,"3ba4cRLLKxA76ObP+M5L2TB","Bomb"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("./Terrain"),r=t("./BombEffect"),s=cc._decorator,n=s.ccclass,a=(s.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isPlayerStop=!1,e.isBombed=!1,e.timer=2,e.index=0,e}var i;return __extends(e,t),i=e,e.prototype.onLoad=function(){this.boxCollider=this.getComponent(cc.BoxCollider),this.effectPrefab=cc.loader.getRes("Bomb/Effect")},e.prototype.update=function(t){this.isBombed||(this.index>=this.timer?this.Bomb():this.index+=t)},e.prototype.onCollisionExit=function(t,e){this.isPlayerStop||t.node==this.player.node&&(this.isPlayerStop=!0)},e.prototype.Bomb=function(){if(!this.isBombed){this.index=0,this.isBombed=!0;var t=this.getLength("up"),e=this.getLength("down"),i=this.getLength("left"),o=this.getLength("right"),s=cc.instantiate(this.effectPrefab);s.position=this.node.position,s.parent=this.node.parent,s.getComponent(r.default).show(t,e,i,o),this.grid.clear(),this.node.parent=null}},e.prototype.getLength=function(t){for(var e=0,r=this.grid[t],s=this.player.getPower();s&&(s--,!1!==r);){if(null==r.data)e++;else{if(r.data instanceof cc.TiledTile){"false"==o.default.Instance.getAttr(r.data.gid).sturdy&&(e++,r.clear());break}r.data instanceof i&&(cc.log("\u70b8\u5f39"),r.data.Bomb())}r=r[t]}return e},e=i=__decorate([n],e)}(cc.Component));i.default=a,cc._RF.pop()},{"./BombEffect":"BombEffect","./Terrain":"Terrain"}],Grid:[function(t,e,i){"use strict";cc._RF.push(e,"aa5c2jr1DlBao8+JnJ/0Yg3","Grid"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("./Terrain"),r=function(){function t(t,e,i,o,r){this.data=null,this.x=t,this.y=e,this.maxX=i,this.maxY=o,r&&(this.data=r)}return Object.defineProperty(t.prototype,"left",{get:function(){var t=this.x-1;return!(t<0)&&this.getGrid(t,this.y)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){var t=this.x+1;return!(t>=this.maxX)&&this.getGrid(t,this.y)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"up",{get:function(){var t=this.y-1;return!(t<=0)&&this.getGrid(this.x,t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"down",{get:function(){var t=this.y+1;return!(t>=this.maxY)&&this.getGrid(this.x,t)},enumerable:!0,configurable:!0}),t.prototype.setData=function(t){this.data=t},t.prototype.getData=function(){return this.data?this.data:null},t.prototype.rmData=function(){this.data=null},t.prototype.getGrid=function(t,e){var i=Math.floor(t)+Math.floor(e)*this.maxX;return this.parent[i]},t.prototype.clear=function(){this.data instanceof cc.TiledTile&&(this.data.node.parent=null,o.default.Instance.removeTile(this.x,this.y)),this.data=null},t}();i.default=r,cc._RF.pop()},{"./Terrain":"Terrain"}],Loading:[function(t,e,i){"use strict";cc._RF.push(e,"a0bf0NmQZ5AKpjXpBM58Q7B","Loading"),Object.defineProperty(i,"__esModule",{value:!0});var o=cc._decorator,r=o.ccclass,s=(o.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onLoad=function(){cc.loader.loadResDir("",function(t,e){cc.director.loadScene("Battle")})},e=__decorate([r],e)}(cc.Component));i.default=s,cc._RF.pop()},{}],Map:[function(t,e,i){"use strict";cc._RF.push(e,"5118aR3ZqpEI4ebGQsvDLuv","Map"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("./Terrain"),r=t("./Player"),s=cc._decorator,n=s.ccclass,a=(s.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.players=[],e}return __extends(e,t),e.prototype.onLoad=function(){cc.director.getCollisionManager().enabled=!0,cc.debug.setDisplayStats(!1),this.playerPrefab=cc.loader.getRes("Player/Player",cc.Prefab),this.node.on("PlayerDie",this.PlayerDie,this)},e.prototype.start=function(){this.tiledMap=this.getComponent(cc.TiledMap);new o.default(this.tiledMap);var t=cc.instantiate(this.playerPrefab);t.parent=this.node;var e=t.getComponent(r.default);e.init("\u5b9d\u5b9d",cc.v2(0,1));var i=cc.instantiate(this.playerPrefab);i.parent=this.node;var s=i.getComponent(r.default);s.init("\u6d77\u76d7\u8239\u957f",cc.v2(14,13),{up:38,down:40,left:37,right:39,attack:110}),this.players.push(e,s),cc.log(this.players)},e.prototype.PlayerDie=function(t){for(var e=this.players.length-1;e>=0;e--)this.players[e].node==t.target&&this.players.splice(e,1);1==this.players.length&&(this.players[0].state=5,this.scheduleOnce(function(){},5))},e=__decorate([n],e)}(cc.Component));i.default=a,cc._RF.pop()},{"./Player":"Player","./Terrain":"Terrain"}],Player:[function(t,e,i){"use strict";cc._RF.push(e,"5b486nzKiVD/rXUqAh0yhFC","Player"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("./Terrain"),r=t("./Bomb"),s=t("./Role"),n=cc._decorator,a=n.ccclass,h=(n.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._state=1,e._dir=1,e.speed=3,e.isCollider=!1,e.offsetDir=0,e.power=1,e.dieTimer=5,e.dieIndex=0,e.keyValue={up:87,down:83,left:65,right:68,attack:17},e}return __extends(e,t),Object.defineProperty(e.prototype,"state",{get:function(){return this._state},set:function(t){this.state!=t&&(this._state=t,this.playAnim())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dir",{get:function(){return this._dir},set:function(t){this.dir!=t&&(this._dir=t,this.playAnim())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"terrain",{get:function(){return this._terrain||(this._terrain=new o.default),this._terrain},enumerable:!0,configurable:!0}),e.prototype.onLoad=function(){this.bombPrefab=cc.loader.getRes("Bomb/Bomb",cc.Prefab),this.roleAnimCom=this.node.getChildByName("texture").getComponent(cc.Animation),this.effectAnimCom=this.node.getChildByName("effect").getComponent(cc.Animation),this.boxCollider=this.getComponent(cc.BoxCollider);var t=this.boxCollider.size;this.min_inclusive=cc.v2(t.width/2,t.height/2);var e=this.terrain.mapContentSize;e.y-=this.terrain.tileSize.y,this.max_inclusive=e.sub(this.min_inclusive),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.KeyDown,this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this.KeyUp,this)},e.prototype.init=function(t,e,i){i&&(this.keyValue=i),this.node.position=this.terrain.getTilePosition(e);var o=s.default.Instance.getRole(t);this.roleData=o;for(var r=cc.loader.getRes("Role/"+o.texture,cc.SpriteAtlas),n=1;n<=4;n++){var a=cc.AnimationClip.createWithSpriteFrames([r.getSpriteFrame("1"+n+"1")],1);a.name="1-"+n,this.roleAnimCom.addClip(a);for(var h=[],c=1;c<=6;c++)h.push(r.getSpriteFrame("2"+n+c));var l=cc.AnimationClip.createWithSpriteFrames(h,6);l.name="2-"+n,l.wrapMode=cc.WrapMode.Loop,this.roleAnimCom.addClip(l)}for(h=[],n=1;n<=11;n++){var d=n<10?"0"+n:n.toString();h.push(r.getSpriteFrame("4"+d))}var p=cc.AnimationClip.createWithSpriteFrames(h,11);p.name="4",this.roleAnimCom.addClip(p),h=[];for(n=1;n<=8;n++)h.push(r.getSpriteFrame("50"+n));var u=cc.AnimationClip.createWithSpriteFrames(h,8);u.name="5",u.wrapMode=cc.WrapMode.Loop,this.roleAnimCom.addClip(u),this.speed=this.roleData.speed,this.power=this.roleData.power,this.playAnim()},e.prototype.playAnim=function(){var t=this,e=this.state,i=this.dir;if(this.node.pauseAllActions(),e<=2){var o=e+"-"+i;this.roleAnimCom.node.scale=1,this.effectAnimCom.stop(),this.roleAnimCom.play(o)}if(3==e)this.roleAnimCom.stop(),this.roleAnimCom.node.scale=.8,this.effectAnimCom.play("3"),this.effectAnimCom.on("finished",function(){var e=cc.moveBy(.6,0,5),i=cc.moveBy(.6,0,-5),o=cc.moveBy(.6,0,-5),r=cc.moveBy(.6,0,5),s=cc.sequence(e,i,o,r),n=cc.repeatForever(s);n.setTag(9),t.node.runAction(n)});else if(4==e){this.effectAnimCom.play("4");var r=new cc.Event.EventCustom("PlayerDie",!0);this.node.dispatchEvent(r),this.effectAnimCom.on("finished",function(){t.roleAnimCom.node.scale=1,t.roleAnimCom.play("4")})}else 5==e&&this.roleAnimCom.play("5")},e.prototype.KeyDown=function(t){if(!(this.state>2))switch(t.keyCode){case this.keyValue.up:this.dir=1,this.state=2;break;case this.keyValue.down:this.dir=2,this.state=2;break;case this.keyValue.left:this.dir=3,this.state=2;break;case this.keyValue.right:this.dir=4,this.state=2}},e.prototype.KeyUp=function(t){if(!(this.state>2))switch(t.keyCode){case this.keyValue.up:case this.keyValue.down:case this.keyValue.left:case this.keyValue.right:this.state=1;break;case this.keyValue.attack:this.putBomb()}},e.prototype.putBomb=function(){var t=this.terrain.getGrid(this.node.position,!0);if(t.getData())return!1;var e=cc.instantiate(this.bombPrefab);e.parent=this.node.parent,e.position=this.terrain.normalizeV2(this.node.position);var i=e.getComponent(r.default);i.player=this,i.grid=t,t.setData(i)},e.prototype.getPower=function(){return this.power},e.prototype.upPower=function(){this.power++},e.prototype.update=function(t){if(2==this.state&&this.move(),3==this.state){if(this.dieIndex>=this.dieTimer)return this.dieIndex=0,void(this.state=4);this.dieIndex+=t}},e.prototype.move=function(){var t=cc.Vec2.ZERO;switch(this.dir){case 1:t.y=1;break;case 2:t.y=-1;break;case 3:t.x=-1;break;case 4:t.x=1}t.mulSelf(this.speed);var e=this.node.position.clone();e=(e=e.add(t)).clampf(this.min_inclusive,this.max_inclusive),this.node.position=e},e.prototype.lateUpdate=function(){if(2==this.state&&this.isCollider){var t=this.lastPosition;if(console.log(t),this.offsetDir)switch(this.offsetDir){case 1:t.y+=this.speed;break;case 2:t.y-=this.speed;break;case 3:t.x-=this.speed;break;case 4:t.x+=this.speed}this.node.position=t}this.lastPosition=this.node.position},e.prototype.onCollisionEnter=function(t,e){if("Attack"!=t.node.group){var i=!1;if("Bomb"==t.node.group){var o=t.getComponent(r.default);o.isPlayerStop||o.player!=this||(i=!0)}this.offsetDir=0;var s=e.world.aabb,n=t.world.aabb;3!=this.dir&&4!=this.dir||(s.y<n.y-n.height/2&&(this.offsetDir=2),s.y>n.y+n.height/2&&(this.offsetDir=1)),1!=this.dir&&2!=this.dir||(s.x<n.x-n.width/2&&(this.offsetDir=3),s.x>n.x+n.width/2&&(this.offsetDir=4)),i||(this.isCollider=!0)}else this.state=3},e.prototype.onCollisionExit=function(){this.isCollider=!1},e=__decorate([a],e)}(cc.Component));i.default=h,cc._RF.pop()},{"./Bomb":"Bomb","./Role":"Role","./Terrain":"Terrain"}],Role:[function(t,e,i){"use strict";cc._RF.push(e,"bbbadKyWwdAS43jSVB5U4xE","Role"),Object.defineProperty(i,"__esModule",{value:!0});var o=cc._decorator,r=o.ccclass,s=(o.property,function(){function t(){this.data=[{name:"\u5b9d\u5b9d",texture:"role1",count:1,maxcount:6,power:1,maxpower:7,speed:5,maxspeed:9,desc:"\u53c8\u61d2\u53c8\u7231\u7761\u89c9\uff0c\u4f46\u662f\u5f88\u4e50\u89c2\u7684\u5b69\u5b50\u3002"},{name:"\u6d77\u76d7\u8239\u957f",texture:"role2",count:3,maxcount:10,power:6,maxpower:10,speed:3,maxspeed:10,desc:"\u4ee5\u518d\u6d17\u4e3a\u4e2d\u5fc3\u6d3b\u52a8\u7684\u6d77\u76d7\u5934\u9886\uff0c\u5f88\u6b8b\u5fcd\uff0c\u4e0d\u559c\u6b22\u5b69\u5b50\uff0c\u4f46\u662f\u6015\u6c34\u7684\u5f88\u5947\u602a\u7684\u6d77\u76d7\u3002"}]}var e;return e=t,t.prototype.getRole=function(t){for(var e=0;e<this.data.length;e++)if(this.data[e].name==t)return this.data[e]},t.Instance=new e,t=e=__decorate([r],t)}());i.default=s,cc._RF.pop()},{}],Terrain:[function(t,e,i){"use strict";cc._RF.push(e,"ea04b6NScZDU5GfPFr+upR9","Terrain"),Object.defineProperty(i,"__esModule",{value:!0});var o=t("./Grid"),r=function(){function t(e){if(this.terrain=[],t.Instance)return t.Instance;e&&(t.Instance=this,this.tiledMap=e,this.square=this.tiledMap.getLayer("Square"),this.init())}return t.prototype.init=function(){var t=this.tiledMap.getTileSize();this.tileSize=new cc.Vec2(t.width,t.height);var e=this.tiledMap.getMapSize();this.mapSize=cc.v2(e.width,e.height),this.mapContentSize=cc.v2(this.tileSize.x*this.mapSize.x,this.tileSize.y*this.mapSize.y);this.mapSize.x,this.mapSize.y;for(var i=0;i<e.width;i++)for(var r=0;r<e.height;r++){var s=this.getTile(i,r),n=new o.default(i,r,this.mapSize.x,this.mapSize.y,s);n.parent=this.terrain;var a=i+r*e.width;this.terrain[a]=n}},t.prototype.getTile=function(t,e){var i=this.square.getTiledTileAt(t,e,!0);if(i.gid>0&&this.tiledMap.getPropertiesForGID(i.gid)){if(!i.getComponent(cc.BoxCollider)){var o=i.node.addComponent(cc.BoxCollider);i.node.group="Tile",o.size=new cc.Size(this.tileSize.x,this.tileSize.y),o.offset.x=this.tileSize.x/2,o.offset.y=this.tileSize.y/2}return i}return null},t.prototype.convertToMapSpace=function(t){var e=Math.floor(t.x/this.tileSize.x),i=Math.ceil((this.mapSize.y*this.tileSize.y-t.y)/this.tileSize.y)-1;return new cc.Vec2(e,i)},t.prototype.getTilePosition=function(t){console.log(t);t=this.square.getPositionAt(t);return console.log(t),console.log(this.tileSize.mul(.5)),console.log(t.add(this.tileSize.mul(.5))),console.log("---------------"),t.add(this.tileSize.mul(.5))},t.prototype.normalizeV2=function(t){var e=this.convertToMapSpace(t),i=e.x*this.tileSize.x+this.tileSize.x/2,o=(this.mapSize.y-e.y)*this.tileSize.y-this.tileSize.y/2;return new cc.Vec2(i,o)},t.prototype.getGrid=function(t,e){void 0===e&&(e=!1),e&&(t=this.convertToMapSpace(t));var i=t.x,o=t.y,r=Math.floor(i)+Math.floor(o)*this.mapSize.x;return this.terrain[r]},t.prototype.getAttr=function(t){return this.tiledMap.getPropertiesForGID(t)},t.prototype.removeTile=function(t,e){this.square.setTileGIDAt(0,t,e)},t}();i.default=r,cc._RF.pop()},{"./Grid":"Grid"}]},{},["Bomb","BombEffect","Grid","Map","Player","Role","Terrain","Loading"]);